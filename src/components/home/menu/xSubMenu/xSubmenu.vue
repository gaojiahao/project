<template>
<li class="ivu-menu-submenu" :class="[ activeMenu ? 'ivu-menu-opened':'ivu-menu-submenu-color']">
    <div class="ivu-menu-submenu-title" @click="clickMenu(parentItem&&parentItem.oneLevel,item)" v-if="item&&item.enabled">
        <i class="ivu-icon ivu-icon-ios-navigate"></i>
        <span class="ivu-menu-text" v-if="!isCollapsed">{{item.name}}</span>
        <i class="ivu-icon ivu-icon-ios-arrow-down" :class="[(opendedChild||opendedChildCom) ? 'ivu-menu-submenu-title-icon-up' : 'ivu-menu-submenu-title-icon-down']" v-if="item&&item.children&&item.children.length&&!isCollapsed"></i>
    </div>
    <collapse-transition v-if="mode === 'vertical'">
        <ul class="ivu-menu" v-show="opendedChild||opendedChildCom" v-for="(data,k) in item.children" :key="k">
            <li class="ivu-menu-item ivu-menu-box" :class="[activeMenu2==data.code ? 'ivu-menu-box-active':'']" @click="clickMenu(parentItem&&parentItem.oneLevel,item,data,false)" v-if="data.enabled">{{data.name}}
            </li>
        </ul>
    </collapse-transition>
</li>
</template>

<script>
import {
    Drop
} from "view-design";
import CollapseTransition from './js/collapse-transition';
import {
    getStyle,
    findComponentUpward,
    findComponentsDownward
} from './js/assist';
import Emitter from './js/emitter';
import mixin from './js/mixin';

const prefixCls = 'ivu-menu';

export default {
    name: 'XSubmenu',
    mixins: [Emitter, mixin],
    components: {
        Drop,
        CollapseTransition
    },
    props: {
        item: {
            type: Object,
            default () {
                return {}
            },
        },
        disabled: {
            type: Boolean,
            default: false
        },
        parentItem: {
            type: Object,
            default () {
                return {}
            },
        },
        isCollapsed: {
            type: Boolean,
            dafault: false
        }
    },
    data() {
        return {
            prefixCls: prefixCls,
            active: false,
            opened: false,
            dropWidth: parseFloat(getStyle(this.$el, 'width')),
            opendedChild: false,
        };
    },
    computed: {
        arrowType() {
            let type = 'ivu-menu-submenu-title-icon-down';

            if (this.opened && this.$store.state.menuRouter.twoLevel && (this.$store.state.menuRouter.twoLevel.code == this.item.code)) {
                type = 'ivu-menu-submenu-title-icon-up';
            } else {
                if (this.$store.state.menuRouter.thirdLevel && this.$store.state.menuRouter.thirdLevel.code) {
                    type = 'ivu-menu-submenu-title-icon-up';
                }
            }
            return type;
        },
        activeMenu() {
            if (this.$store.state.menuRouter.twoLevel && (this.$store.state.menuRouter.twoLevel.code == this.item.code)) {
                return true; //需要监听的数据
            } else {
                return false;
            }
        },
        activeMenu2() {
            if (this.$store.state.menuRouter.thirdLevel && (this.$store.state.menuRouter.thirdLevel.code)) {
                return this.$store.state.menuRouter.thirdLevel.code; //需要监听的数据
            } else {
                return false;
            }
        },
        opendedChildCom() {
            if (this.$store.state.menuRouter.twoLevel && this.$store.state.menuRouter.twoLevel.code == this.item.code) {

                return this.opendedChild ? false : true; //需要监听的数据
            } else {
                return false;
            }
        }
    },
    methods: {
        clickMenu(one, two, third, flag = true) {
            var data = {};
            var routerPath = "/";
            if (one) {
                data['oneLevel'] = one;
                routerPath = routerPath + one.code;
            }
            if (two) {
                data['twoLevel'] = two;
                routerPath = routerPath + '/' + two.code;
            }
            if (third) {
                data['thirdLevel'] = third;
                routerPath = routerPath + '/' + third.code;
            }
            this.activeIndex = data;
            this.$store.commit('setMenuRouter', data);
            this.$router.push(routerPath);
        },
        opendedChildFun() {
            this.opendedChild = this.opendedChild ? false : true;
        }
    },
};
</script>

<style lang="less" scoped>
.ivu-menu-opened {
    color: #FFFFFF;
    background: #447ED9;
    z-index: 2;
}

.ivu-menu-text {
    display: inline-block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    vertical-align: bottom;
    transition: width 0.2s ease 0.2s;
}
.ivu-menu-box{
    background: rgb(220, 222, 226);
    text-align: left;
}
.ivu-menu-box-active {
    color: #447ED9;
}
.ivu-menu-vertical .ivu-menu-submenu .ivu-menu-item {
    padding: 14px 14px 14px 40px;
}
</style>
<style scoped>
>>> .ivu-menu-vertical .ivu-menu-item, .ivu-menu-vertical .ivu-menu-submenu-title  {
    padding: 14px 14px;
    position: relative;
    cursor: pointer;
    z-index: 1;
    transition: all 0.2s ease-in-out;
    text-align: center;
}
.ivu-menu-submenu-title > i, .ivu-menu-submenu-title span > i {
    margin-right: 0;
}
.ivu-icon /deep/ {
    vertical-align: middle;
    font-size: 16px;
    margin-right: 6px;
}

.ivu-menu-opened /deep/ {
    color: #FFFFFF;
    background: #447ED9;
    z-index: 2;
}

.ivu-menu-submenu-color {
    background: #DEE7F4;    
}
</style>
